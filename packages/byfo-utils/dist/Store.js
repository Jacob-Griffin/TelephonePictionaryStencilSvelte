"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TPStore = void 0;
const byfo_themes_1 = require("byfo-themes");
const customStyleDefaults = {
    backgroundBlur: '0',
    backgroundBrightness: '1',
    backgroundSaturation: '1',
};
class TPStore {
    changeEvent = (setting, value) => new CustomEvent('tp-settings-changed', { detail: { setting, value } });
    theme = localStorage.getItem('theme') ?? 'classic';
    setTheme = (v) => {
        this.useTheme(v);
        localStorage.setItem('theme', v);
        this.theme = v;
    };
    useTheme = (theme = this.theme) => {
        document.body.setAttribute('class', '');
        const visitedThemes = new Set();
        let currentTheme = theme;
        while (currentTheme && !visitedThemes.has(currentTheme)) {
            visitedThemes.add(currentTheme);
            document.body.classList.add(currentTheme);
            currentTheme = byfo_themes_1.themes[currentTheme].extends;
        }
    };
    customStyle = {
        backgroundBlur: localStorage.getItem('backgroundBlur') ?? customStyleDefaults['backgroundBlur'],
        backgroundBrightness: localStorage.getItem('backgroundBrightness') ?? customStyleDefaults['backgroundBrightness'],
        backgroundSaturation: localStorage.getItem('backgroundSaturation') ?? customStyleDefaults['backgroundSaturation'],
    };
    setCustomStyle = (prop, v) => {
        console.log(prop);
        console.log(v);
        this.customStyle[prop] = `${v}`;
        localStorage.setItem(prop, `${v}`);
        this.useCustomStyles();
        console.log(this.customStyle);
    };
    resetCustomStyles = () => {
        this.customStyle = { ...customStyleDefaults };
        Object.entries(customStyleDefaults).forEach(([prop, value]) => {
            localStorage.setItem(prop, value);
        });
        this.useCustomStyles();
    };
    useCustomStyles = () => {
        let styleTag = document.getElementById('customized-theme');
        if (!styleTag) {
            styleTag = document.createElement('style');
            styleTag.id = 'customized-theme';
            document.head.appendChild(styleTag);
        }
        styleTag.innerHTML = '';
        const newStyles = Object.entries(this.customStyle).map(([prop, value]) => {
            const kabobPropName = prop.replace(/[A-Z]/, (char) => `-${char.toLowerCase()}`);
            return `--customized-${kabobPropName}: ${value};`;
        });
        styleTag.innerText = `:root{${newStyles.join('')}}`;
    };
    alwaysShowAll = !!localStorage.getItem('alwaysShowAll');
    setShowAll = (v) => {
        localStorage.setItem('alwaysShowAll', !v ? '' : 'true');
        this.alwaysShowAll = !!v;
        const e = this.changeEvent('alwaysShowAll', `${!!v}`);
        document.dispatchEvent(e);
    };
    landscapeDismissed = !!sessionStorage.getItem('landscapeDismissed');
    setLandscapeDismissed = (v) => {
        sessionStorage.setItem('landscapeDismissed', !v ? '' : 'true');
        this.landscapeDismissed = true;
        const e = this.changeEvent('landscapeDismissed', `${!!v}`);
        document.dispatchEvent(e);
    };
    username = localStorage.getItem('username');
    setUsername = (v) => {
        if (!v) {
            localStorage.removeItem('username');
            this.username = undefined;
            return;
        }
        localStorage.setItem('username', v);
        this.username = v;
    };
    gameid = localStorage.getItem('game-playing');
    setGameid = (v) => {
        if (!v) {
            localStorage.removeItem('game-playing');
            this.gameid = undefined;
            return;
        }
        localStorage.setItem('game-playing', v);
        this.gameid = v;
    };
    hosting = localStorage.getItem('hosting');
    setHosting = (v) => {
        if (!v) {
            localStorage.removeItem('hosting');
            this.hosting = undefined;
            return;
        }
        localStorage.setItem('hosting', v);
        this.hosting = v;
    };
    rejoinNumber = localStorage.getItem('rejoinNumber');
    setRejoinNumber = (v) => {
        if (!v) {
            localStorage.removeItem('rejoinNumber');
            this.rejoinNumber = undefined;
            return;
        }
        localStorage.setItem('rejoinNumber', v);
        this.rejoinNumber = v;
    };
    searchAs = localStorage.getItem('searchAs');
    setSearchAs = (v) => {
        if (!v) {
            localStorage.removeItem('searchAs');
            this.searchAs = undefined;
            return;
        }
        localStorage.setItem('searchAs', v);
        this.searchAs = v;
        const e = this.changeEvent('searchAs', v);
        document.dispatchEvent(e);
    };
    getRejoinData() {
        if (!this.gameid || !this.username)
            return null;
        return {
            gameid: this.gameid,
            name: this.username,
        };
    }
    clearGameData() {
        this.setUsername(undefined);
        this.setGameid(undefined);
        this.setHosting(undefined);
        this.setRejoinNumber(undefined);
    }
}
exports.TPStore = TPStore;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RvcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvU3RvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkNBQXFDO0FBRXJDLE1BQU0sbUJBQW1CLEdBQTBCO0lBQ2pELGNBQWMsRUFBRSxHQUFHO0lBQ25CLG9CQUFvQixFQUFFLEdBQUc7SUFDekIsb0JBQW9CLEVBQUUsR0FBRztDQUMxQixDQUFBO0FBQ0QsTUFBYSxPQUFPO0lBQ2xCLFdBQVcsR0FBRyxDQUFDLE9BQWUsRUFBRSxLQUFhLEVBQUUsRUFBRSxDQUFDLElBQUksV0FBVyxDQUFDLHFCQUFxQixFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztJQUV6SCxLQUFLLEdBQVcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxTQUFTLENBQUM7SUFDM0QsUUFBUSxHQUFHLENBQUMsQ0FBUyxFQUFFLEVBQUU7UUFDdkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQixZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztJQUNqQixDQUFDLENBQUM7SUFFRixRQUFRLEdBQUcsQ0FBQyxRQUFnQixJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUU7UUFDeEMsUUFBUSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3hDLE1BQU0sYUFBYSxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7UUFDaEMsSUFBSSxZQUFZLEdBQUcsS0FBSyxDQUFDO1FBQ3pCLE9BQU8sWUFBWSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDO1lBQ3hELGFBQWEsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7WUFD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